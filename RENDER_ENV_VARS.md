# Render Environment Variables - Ready to Copy

**Copy these exact values to Render Dashboard â†’ propgroup-backend â†’ Environment**

---

## âœ… ALREADY CONFIGURED (via render.yaml)

These are automatically set when you deploy using the render.yaml Blueprint:

```
âœ“ NODE_ENV=production
âœ“ PORT=3001
âœ“ DATABASE_URL=postgresql://propgroup_database_user:N47ZWO9oy6BsGhYdZWd7tqBivUfgCYeh@dpg-d3ro26jipnbc73epphb0-a/propgroup_database
âœ“ JWT_SECRET (auto-generated)
âœ“ SESSION_SECRET (auto-generated)
```

---

## ğŸ”§ YOU NEED TO ADD THESE

After deployment, add these in Render Dashboard:

### Step 1: Get Your Backend URL

After Render deploys, your backend URL will be:
```
https://propgroup-backend.onrender.com
```
(Or whatever name you choose for the service)

### Step 2: Add These Environment Variables

#### BACKEND_URL (Required)
```
BACKEND_URL=https://propgroup-backend.onrender.com
```
â˜ï¸ **Use your actual Render backend URL**

#### FRONTEND_URL (Required - Update after Vercel deployment)
```
FRONTEND_URL=https://your-app.vercel.app
```
â˜ï¸ **Temporary placeholder - UPDATE THIS after deploying to Vercel!**

For multiple frontend domains (production + preview):
```
FRONTEND_URL=https://your-app.vercel.app,https://your-app-git-main.vercel.app
```

#### JWT_EXPIRES_IN (Optional - defaults to 7d)
```
JWT_EXPIRES_IN=7d
```

---

## ğŸ” GOOGLE OAUTH (Optional)

Only add these if you want "Sign in with Google":

### Step 1: Create Google OAuth App

1. Go to https://console.cloud.google.com
2. Create/Select Project
3. Enable Google+ API
4. Credentials â†’ Create OAuth 2.0 Client ID
5. Authorized redirect URIs:
   ```
   https://propgroup-backend.onrender.com/api/auth/google/callback
   http://localhost:3001/api/auth/google/callback
   ```

### Step 2: Add to Render

```
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-your-client-secret
GOOGLE_CALLBACK_URL=https://propgroup-backend.onrender.com/api/auth/google/callback
```

---

## ğŸ“‹ Complete Checklist

After deploying backend to Render, verify these are all set:

### Required Variables:
- [x] `NODE_ENV` = production *(auto-set)*
- [x] `PORT` = 3001 *(auto-set)*
- [x] `DATABASE_URL` = postgresql://... *(auto-set)*
- [x] `JWT_SECRET` = (auto-generated) *(auto-set)*
- [x] `SESSION_SECRET` = (auto-generated) *(auto-set)*
- [ ] `BACKEND_URL` = https://propgroup-backend.onrender.com **â† ADD THIS**
- [ ] `FRONTEND_URL` = (temporary placeholder) **â† ADD THIS, UPDATE AFTER VERCEL**

### Optional Variables:
- [ ] `JWT_EXPIRES_IN` = 7d
- [ ] `GOOGLE_CLIENT_ID` = (if using OAuth)
- [ ] `GOOGLE_CLIENT_SECRET` = (if using OAuth)
- [ ] `GOOGLE_CALLBACK_URL` = (if using OAuth)

---

## ğŸš€ Deployment Flow

### 1. Deploy Backend (Render)

```bash
# From your local machine:
git add .
git commit -m "Configure Render deployment"
git push origin master
```

Then in Render:
1. New â†’ Blueprint
2. Connect repo
3. Render detects `render.yaml` and creates:
   - Backend service (Frankfurt region)
   - All environment variables from render.yaml

### 2. Add Missing Variables

Go to Render Dashboard â†’ propgroup-backend â†’ Environment:

```
BACKEND_URL=https://propgroup-backend.onrender.com
FRONTEND_URL=https://temporary-placeholder.com
```

Click **Save Changes** â†’ Backend redeploys

### 3. Deploy Frontend (Vercel)

1. Go to Vercel â†’ New Project
2. Import your GitHub repo
3. Add environment variable:
   ```
   NEXT_PUBLIC_API_URL=https://propgroup-backend.onrender.com/api
   ```
4. Deploy
5. Get your Vercel URL: `https://your-app.vercel.app`

### 4. Update Backend CORS

Go back to Render â†’ Environment:
```
FRONTEND_URL=https://your-app.vercel.app
```

Save â†’ Backend redeploys

### 5. Done! âœ¨

Test:
```bash
# Backend health check
curl https://propgroup-backend.onrender.com/api/health

# Frontend
open https://your-app.vercel.app
```

---

## ğŸ” Verification Commands

### Check Backend Environment Variables

In Render Shell or logs, you should see:
```bash
ğŸš€ Server running on port 3001
ğŸŒ Environment: production
ğŸ”— Frontend URL: https://your-app.vercel.app
```

### Test Health Endpoint

```bash
curl https://propgroup-backend.onrender.com/api/health
```

Expected response:
```json
{
  "status": "ok",
  "timestamp": "2025-10-22T...",
  "environment": "production",
  "database": "connected"
}
```

### Test CORS

From your browser console on the frontend:
```javascript
fetch('https://propgroup-backend.onrender.com/api/health')
  .then(r => r.json())
  .then(console.log)
```

Should work without CORS errors.

---

## âš ï¸ Important Notes

### Database URL Security
- âœ… The database URL in `render.yaml` is **safe to commit** because:
  - It's the **Internal Database URL** (only accessible from Render services)
  - NOT the External Database URL
  - If someone gets this URL, they can't connect from outside Render

### JWT/Session Secrets
- âœ… Auto-generated by Render (64-character random strings)
- âœ… Different for each deployment
- âœ… Persisted across redeploys

### Region
- âœ… Backend: **Frankfurt (EU Central)**
- âœ… Database: **Frankfurt (EU Central)** (existing)
- âœ… Both in same region = faster database queries

---

## ğŸ†˜ Troubleshooting

### "Migration failed" error
The migration is stuck. Run locally:
```bash
cd packages/db
npx prisma migrate resolve --rolled-back 20251021000001_add_oauth_fields
```

Then redeploy backend.

Or use the script:
```bash
chmod +x fix-migration.sh
./fix-migration.sh
git add packages/db/prisma/migrations/
git commit -m "Fix migration"
git push
```

### "Database connection failed"
- Check DATABASE_URL is the **Internal Database URL**
- Ensure database is in Frankfurt region
- Verify database is not paused (Free tier auto-pauses)

### "CORS error" in frontend
- Verify `FRONTEND_URL` in backend matches your Vercel URL **exactly**
- Include `https://` prefix
- No trailing slash
- Redeploy backend after updating

### Backend won't start
Check Render logs for errors:
- Missing environment variables?
- Migration issues?
- Port conflicts?

---

## ğŸ“š Next Steps

1. âœ… Deploy backend using render.yaml
2. âœ… Add `BACKEND_URL` to Render
3. âœ… Deploy frontend to Vercel
4. âœ… Update `FRONTEND_URL` in Render
5. âœ… Test the deployment
6. ğŸ‰ You're live!

See [DEPLOYMENT.md](DEPLOYMENT.md) for detailed step-by-step guide.
